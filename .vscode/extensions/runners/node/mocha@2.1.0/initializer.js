/*
 * wallaby-core - v1.0.1620
 * https://wallabyjs.com
 * Copyright (c) 2014-2024 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of wallaby-core and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
const utils=global.$_$tracer._utils;utils.patchModulesCode([{files:["mocha/lib/esm-utils.js","mocha/lib/nodejs/esm-utils.js"],replacements:[{from:"return await import(url.pathToFileURL(file));",to:`const fileUrl = url.pathToFileURL(file);
        fileUrl.href = fileUrl.href + "?update=" + new Date().getTime() + '&wallaby=true';
        return await import(fileUrl);`,optional:!0},{from:"return await exports.doImport(esmDecorator(url.pathToFileURL(file)));",to:`const fileUrl = url.pathToFileURL(file);
        fileUrl.href = fileUrl.href + "?update=" + new Date().getTime() + '&wallaby=true';
        return await exports.doImport(esmDecorator(fileUrl));`,optional:!0}]}]),Mocha=global.wallaby._testFrameworkPath?require(global.wallaby._testFrameworkPath):require("mocha");var Mocha,mocha,tracer=global.$_$tracer;tracer.start(async function(){function u(){return t!==global.$_$session}var f=tracer.initialSpecId(),h=[],t=global.$_$session;mocha.reporter(function(a){var o,l=a._grep||/.*/,n=a._invert,i=!1;a._invert=!1,a.runTest=function(e){if(!u()){var r=this.test,i=this;this.asyncOnly&&(r.asyncOnly=!0);try{this._addEventListener?this._addEventListener(r,"error",function(t){i.fail(r,t)}):r.on("error",function(t){i.fail(r,t)}),tracer.specSyncStart();try{r.run(e)}finally{tracer.specSyncEnd()}}catch(t){e(t)}}},a.grep=function(t,e){l=t,n=e,a._invert=!1};function s(t,e){var r=l.test(t);return!!(r=n?!r:r)&&(!tracer.hasSpecFilter()||((r=e.slice(1)).push(t.substr(r.join(" ").length+(i&&0===r.length?0:1))),tracer.specFilter(r)))}a.grepTotal=function(t){var i=0;const a=[];return t.eachTest(function(e){var t=l.test(e.fullTitle());if(t=n?!t:t){var r=[];let t=e;for(;t.parent;)(t=t.parent).title&&r.unshift(t.title);r.unshift(""),s(e.fullTitle(),r)&&a.push(e),i++}}),tracer.specFileTests(Object.values(a.reduce((t,e)=>(t[e.file]?t[e.file].push(e):t[e.file]=[e],t),{})).reduce((t,e)=>{var r=null==(r=null==(r=global.$_$testFiles)?void 0:r.find(t=>t.path===e[0].file))?void 0:r.id;return t.push({specFileId:r,tests:e.map(t=>{for(var e=[t.title];t.parent;)(t=t.parent).title&&e.unshift(t.title);return{path:e,mode:"run"}})}),t},[])),i},a._grep={test:function(t){return s(t,h)}},tracer.needToNotifySingleTestRun()&&(o=a.hook,a.hook=function(t,e){var r,i;if(!u())return"afterEach"!==t?Function.prototype.apply.call(o,this,arguments):(r=arguments,i=this,tracer.notifySingleTestAfterEach(function(){Function.prototype.apply.call(o,i,r)}),void(a.hook=o))}),a.on("start",function(){u()||tracer.started({total:a.total})}),a.on("end",function(){u()||tracer.complete()}),a.on("suite",function(t){i=i||!!t.titlePath,u()||(h.push(t.title),0)}),a.on("suite end",function(){u()||h.pop()}),a.on("test",function(t){u()||(t._id=++f,t._failures=[],t._time=(new tracer._Date).getTime(),tracer.specStart(t._id,t.title,t._testFile,[...h.slice(1),t.title]))}),a.on("fail",function(t,e){u()||("hook"===t.type||t._finished?(t._hook="hook"===t.type&&t.title||!0,t._failures=[e],a.emit("test end",t)):null!=(t=t._failures)&&t.push(e))}),a.on("test end",function(t){if(!u()){t._finished=!0;function e(t){return!!t&&(!0===t.pending||e(t.parent))}var r=tracer.specEnd(),i=e(t),a="passed"===t.state,o=i?"skipped":"executed",l={id:void 0===t._id?++f:t._id,timeRange:r,name:t.title,suite:h.slice(1),status:o,time:i?0:(new tracer._Date).getTime()-t._time,log:[],hook:t._hook,slow:t.slow?t.duration>t.slow():void 0,testFile:t._testFile};if(!a&&!i)for(var n=t._failures,s=0;s<n.length;s++){var c=n[s];l.log.push(tracer.setAssertionData(c,{message:c.message,stack:c.stack}))}l.log.length||delete l.log,tracer.result(l)}})}),mocha.suite.on("pre-require",function(e){var r=e.it;e.it=function(){var t=Function.prototype.apply.call(r,this,arguments);return t._testFile=tracer.entryFile(),t},Object.keys(r).forEach(function(t){e.it[t]=r[t]})}),mocha.loadFilesAsync&&await mocha.loadFilesAsync(),mocha.run(function(){})}),module.exports={init:function(t){mocha&&mocha.dispose&&(mocha._state="referencesCleaned",mocha.dispose()),(mocha=new Mocha).files=t;try{mocha.slow&&mocha.slow(global.wallaby.slowTestThreshold),mocha.fullTrace&&mocha.fullTrace()}catch(t){}return mocha}};